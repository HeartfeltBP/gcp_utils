import os
from gcp_utils import main
import mock

mock_context = mock.Mock()
mock_context.event_id = '617187464135194'
mock_context.timestamp = '2019-07-15T22:09:03.761Z'
mock_context.resource = '/databases/{database}/documents/new_samples/{sample}'

def test_onNewSample(capsys):
    os.chdir('/home/cam/Documents/gcp_utils/gcp_utils/')
    data = {
        'value': {'fields': {
            'username': {'stringValue': 'test_onNewSamples'},
            'sample_id': {'integerValue': 123456789},
            'ppg_raw': {'arrayValue': {'values':
                    [
                    {'doubleValue': -0.176775698932745},
                    {'doubleValue': -0.186282962865876},
                    {'doubleValue': -0.19254084052467602},
                    {'doubleValue': -0.19585387831604},
                    {'doubleValue': -0.19659501534696402},
                    {'doubleValue': -0.19517683293798402},
                    {'doubleValue': -0.192079050067809},
                    {'doubleValue': -0.18775783531366902},
                    {'doubleValue': -0.18269749858481102},
                    {'doubleValue': -0.17739918591688703},
                    {'doubleValue': -0.172296206105076},
                    {'doubleValue': -0.16781717992220402},
                    {'doubleValue': -0.164321340625391},
                    {'doubleValue': -0.16213587979221603},
                    {'doubleValue': -0.16149861892247402},
                    {'doubleValue': -0.162564872815527},
                    {'doubleValue': -0.16542729660445302},
                    {'doubleValue': -0.17007954042120402},
                    {'doubleValue': -0.176436215123904},
                    {'doubleValue': -0.18429741123119803},
                    {'doubleValue': -0.19338472857562303},
                    {'doubleValue': -0.203374227197847},
                    {'doubleValue': -0.21383907602674002},
                    {'doubleValue': -0.22433469367993003},
                    {'doubleValue': -0.234397353742151},
                    {'doubleValue': -0.243606659022256},
                    {'doubleValue': -0.251605918548336},
                    {'doubleValue': -0.258119717907074},
                    {'doubleValue': -0.26304055447732905},
                    {'doubleValue': -0.266391485881147},
                    {'doubleValue': -0.26839188126470404},
                    {'doubleValue': -0.269449613203192},
                    {'doubleValue': -0.27005062350770004},
                    {'doubleValue': -0.270844233288336},
                    {'doubleValue': -0.272526300746583},
                    {'doubleValue': -0.27572863933239},
                    {'doubleValue': -0.28099308209061},
                    {'doubleValue': -0.288670660540764},
                    {'doubleValue': -0.298868338480968},
                    {'doubleValue': -0.31135138167056303},
                    {'doubleValue': -0.32555572597790505},
                    {'doubleValue': -0.340547276616667},
                    {'doubleValue': -0.355075087927942},
                    {'doubleValue': -0.36760143779589505},
                    {'doubleValue': -0.37634759021373504},
                    {'doubleValue': -0.37945444435032205},
                    {'doubleValue': -0.37506904571298605},
                    {'doubleValue': -0.36144436232502203},
                    {'doubleValue': -0.337102906681683},
                    {'doubleValue': -0.30097955157462203},
                    {'doubleValue': -0.252494237678884},
                    {'doubleValue': -0.191678544437997},
                    {'doubleValue': -0.11919942481350701},
                    {'doubleValue': -0.036388396352477},
                    {'doubleValue': 0.054830173847564},
                    {'doubleValue': 0.152023898400225},
                    {'doubleValue': 0.25241803962859},
                    {'doubleValue': 0.352850684383817},
                    {'doubleValue': 0.45022688568530705},
                    {'doubleValue': 0.541592408562517},
                    {'doubleValue': 0.6240783560398341},
                    {'doubleValue': 0.695301242935725},
                    {'doubleValue': 0.7533625274300241},
                    {'doubleValue': 0.7969286388832311},
                    {'doubleValue': 0.825292499205546},
                    {'doubleValue': 0.83837186012773},
                    {'doubleValue': 0.8366457559640621},
                    {'doubleValue': 0.821152362141304},
                    {'doubleValue': 0.7933423808038931},
                    {'doubleValue': 0.7550020645277551},
                    {'doubleValue': 0.7081020083072751},
                    {'doubleValue': 0.654662721032321},
                    {'doubleValue': 0.5967258434174381},
                    {'doubleValue': 0.5361727747901031},
                    {'doubleValue': 0.47470214524305604},
                    {'doubleValue': 0.41376849784311603},
                    {'doubleValue': 0.354554733483793},
                    {'doubleValue': 0.29797880964293505},
                    {'doubleValue': 0.24467973884017402},
                    {'doubleValue': 0.195065327404206},
                    {'doubleValue': 0.14932653497524},
                    {'doubleValue': 0.10756279707998301},
                    {'doubleValue': 0.069689754202231},
                    {'doubleValue': 0.035548376121315},
                    {'doubleValue': 0.004991299791178},
                    {'doubleValue': -0.022158405549087},
                    {'doubleValue': -0.04610900960527},
                    {'doubleValue': -0.067035553617589},
                    {'doubleValue': -0.085109425558302},
                    {'doubleValue': -0.10049892997366501},
                    {'doubleValue': -0.11336918902939801},
                    {'doubleValue': -0.12390844625372001},
                    {'doubleValue': -0.132302988244122},
                    {'doubleValue': -0.138775001348096},
                    {'doubleValue': -0.143553233726733},
                    {'doubleValue': -0.146890891387814},
                    {'doubleValue': -0.14906947057015701},
                    {'doubleValue': -0.150363853864245},
                    {'doubleValue': -0.15106844870004602},
                    {'doubleValue': -0.15148875800886302},
                    {'doubleValue': -0.15191173203313502},
                    {'doubleValue': -0.152625243079409},
                    {'doubleValue': -0.153897675538855},
                    {'doubleValue': -0.15596898921184002},
                    {'doubleValue': -0.159052811251871},
                    {'doubleValue': -0.16333007280480602},
                    {'doubleValue': -0.168886110833976},
                    {'doubleValue': -0.175783168758883},
                    {'doubleValue': -0.183999717432934},
                    {'doubleValue': -0.193429529645908},
                    {'doubleValue': -0.20387747230730602},
                    {'doubleValue': -0.215085323197328},
                    {'doubleValue': -0.22673215119977602},
                    {'doubleValue': -0.238429850152014},
                    {'doubleValue': -0.24980339278413202},
                    {'doubleValue': -0.260464938968952},
                    {'doubleValue': -0.27007814368925603},
                    {'doubleValue': -0.27842351602945004},
                    {'doubleValue': -0.285391086104445},
                    {'doubleValue': -0.291009418713978},
                    {'doubleValue': -0.29549073199914605},
                    {'doubleValue': -0.299210932039006},
                    {'doubleValue': -0.30267140670040305},
                    {'doubleValue': -0.306474950457217},
                    {'doubleValue': -0.311274898478056},
                    {'doubleValue': -0.3176797759428},
                    {'doubleValue': -0.326175377422993},
                    {'doubleValue': -0.337073951728564},
                    {'doubleValue': -0.35039852580256103},
                    {'doubleValue': -0.36584348732212},
                    {'doubleValue': -0.38275560227211003},
                    {'doubleValue': -0.400059882915455},
                    {'doubleValue': -0.41636243921953003},
                    {'doubleValue': -0.429929162103147},
                    {'doubleValue': -0.43879671079561205},
                    {'doubleValue': -0.44088695417320706},
                    {'doubleValue': -0.434118914103844},
                    {'doubleValue': -0.41657751981504604},
                    {'doubleValue': -0.386654242450135},
                    {'doubleValue': -0.343227685677479},
                    {'doubleValue': -0.285741790901376},
                    {'doubleValue': -0.21434071859377102},
                    {'doubleValue': -0.129876673126091},
                    {'doubleValue': -0.033866437799070004},
                    {'doubleValue': 0.071312580872121},
                    {'doubleValue': 0.182854181038125},
                    {'doubleValue': 0.297626458671911},
                    {'doubleValue': 0.41199972884274405},
                    {'doubleValue': 0.5223983855452601},
                    {'doubleValue': 0.6253703919855771},
                    {'doubleValue': 0.7177490871416241},
                    {'doubleValue': 0.7968489975532671},
                    {'doubleValue': 0.860567766770123},
                    {'doubleValue': 0.9075094930489981},
                    {'doubleValue': 0.93701236595679},
                    {'doubleValue': 0.9491521913469411},
                    {'doubleValue': 0.944675533543414},
                    {'doubleValue': 0.924926286072117},
                    {'doubleValue': 0.891718109608809},
                    {'doubleValue': 0.847176106452117},
                    {'doubleValue': 0.7936237322267361},
                    {'doubleValue': 0.7334330152616241},
                    {'doubleValue': 0.6688543368028681},
                    {'doubleValue': 0.6019845224539471},
                    {'doubleValue': 0.534612030817982},
                    {'doubleValue': 0.468222088232827},
                    {'doubleValue': 0.40395448198375905},
                    {'doubleValue': 0.34260164146419403},
                    {'doubleValue': 0.284631917351497},
                    {'doubleValue': 0.230332457329626},
                    {'doubleValue': 0.179723086207343},
                    {'doubleValue': 0.132695003408247},
                    {'doubleValue': 0.089132703988911},
                    {'doubleValue': 0.048863090166652},
                    {'doubleValue': 0.011733215898770001},
                    {'doubleValue': -0.022328190083822003},
                    {'doubleValue': -0.053366044559621004},
                    {'doubleValue': -0.081368168267861},
                    {'doubleValue': -0.10629742025833301},
                    {'doubleValue': -0.128093103783913},
                    {'doubleValue': -0.146745881315184},
                    {'doubleValue': -0.16226620509302903},
                    {'doubleValue': -0.17473173585492802},
                    {'doubleValue': -0.184329444320523},
                    {'doubleValue': -0.19127457897421501},
                    {'doubleValue': -0.19592490747799002},
                    {'doubleValue': -0.19867174925112302},
                    {'doubleValue': -0.19999584858829503},
                    {'doubleValue': -0.20041709971606902},
                    {'doubleValue': -0.20045399063827002},
                    {'doubleValue': -0.20064157218275402},
                    {'doubleValue': -0.20147846371806202},
                    {'doubleValue': -0.203407528441805},
                    {'doubleValue': -0.20680052654167103},
                    {'doubleValue': -0.21191747511626102},
                    {'doubleValue': -0.21891431857190402},
                    {'doubleValue': -0.22784392759111102},
                    {'doubleValue': -0.23859941304798402},
                    {'doubleValue': -0.250944782570427},
                    {'doubleValue': -0.264541618845588},
                    {'doubleValue': -0.278916057640524},
                    {'doubleValue': -0.29351059834589704},
                    {'doubleValue': -0.30771794933240104},
                    {'doubleValue': -0.32088230405886703},
                    {'doubleValue': -0.33237719845123004},
                    {'doubleValue': -0.34163683489736},
                    {'doubleValue': -0.34814455208258704},
                    {'doubleValue': -0.351570114378477},
                    {'doubleValue': -0.351785493809709},
                    {'doubleValue': -0.34887282034817},
                    {'doubleValue': -0.34333145517171304},
                    {'doubleValue': -0.335584294556233},
                    {'doubleValue': -0.326582492457041},
                    {'doubleValue': -0.31757968244585505},
                    {'doubleValue': -0.30960760055950204},
                    {'doubleValue': -0.303887003312005},
                    {'doubleValue': -0.30155387762455504},
                    {'doubleValue': -0.303508862505591},
                    {'doubleValue': -0.310348161636321},
                    {'doubleValue': -0.32219077304429605},
                    {'doubleValue': -0.338701232991716},
                    {'doubleValue': -0.35907666239747604},
                    {'doubleValue': -0.38191026327466304},
                    {'doubleValue': -0.40532146487035803},
                    {'doubleValue': -0.42701876140423506},
                    {'doubleValue': -0.44440307840478704},
                    {'doubleValue': -0.45472430998359203},
                    {'doubleValue': -0.455254320674819},
                    {'doubleValue': -0.44349714546553903},
                    {'doubleValue': -0.41734811679461603},
                    {'doubleValue': -0.37526992037001805},
                    {'doubleValue': -0.316523506518678},
                    {'doubleValue': -0.24114268788426002},
                    {'doubleValue': -0.15005535982711202},
                    {'doubleValue': -0.045102768832925},
                    {'doubleValue': 0.07107731682104801},
                    {'doubleValue': 0.19514794604363803},
                    {'doubleValue': 0.32329143911073704},
                    {'doubleValue': 0.45138087396430804},
                    {'doubleValue': 0.575228445521213},
                    {'doubleValue': 0.690833214067147},
                    {'doubleValue': 0.7945933551702371},
                    {'doubleValue': 0.8834707004434411},
                    {'doubleValue': 0.9551741497908841},
                    {'doubleValue': 1.008142246848837},
                    {'doubleValue': 1.0417173816136711},
                    {'doubleValue': 1.05603823163846},
                    {'doubleValue': 1.051945863543407},
                    {'doubleValue': 1.030949580941176},
                    {'doubleValue': 0.9950692967141811},
                    {'doubleValue': 0.94666003811492},
                    {'doubleValue': 0.8882670253809821},
                    {'doubleValue': 0.822486981596879},
                    {'doubleValue': 0.751796115196623},
                    {'doubleValue': 0.6784655802045161},
                    {'doubleValue': 0.6044406374583421},
                ]
            }}
        }}
    }
    main.onNewSample(data, mock_context)
    out, err = capsys.readouterr()
    assert out

# def test_onValidSample():
#     data = {}
#     req = Mock(get_json=Mock(return_value=data), args=data)

#     # Call tested function
#     assert main.hello_http(req) == 'Hello World!'
